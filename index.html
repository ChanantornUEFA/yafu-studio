<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chord Studio Cloud</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<style>
body{font-family:Arial;background:#111;color:white;margin:0;padding:20px}
input,textarea,button{padding:10px;margin:5px 0;border-radius:6px;border:none;width:100%}
button{background:#00c3ff;color:black;font-weight:bold}
.song{background:#222;padding:10px;margin:5px 0;border-radius:6px}
</style>
</head>
<body>

<h2>üé∏ Chord Studio Cloud</h2>

<div id="authBox">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="app" style="display:none">
  <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

  <h3>‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
  <div id="songs"></div>

  <input id="newTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á">
  <textarea id="newLyrics" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á"></textarea>
  <button onclick="addSong()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</button>
</div>

<script>
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDShOz9kvrUskPEpYy2nYHtKWMbz56vTc",
  authDomain: "yafustudio.firebaseapp.com",
  projectId: "yafustudio"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

function register(){
  createUserWithEmailAndPassword(auth,email.value,password.value)
  .then(()=>alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"))
  .catch(e=>alert(e.message));
}

function login(){
  signInWithEmailAndPassword(auth,email.value,password.value)
  .catch(e=>alert(e.message));
}

function logout(){
  signOut(auth);
}

onAuthStateChanged(auth,user=>{
  if(user){
    authBox.style.display="none";
    app.style.display="block";
    loadSongs();
  }else{
    authBox.style.display="block";
    app.style.display="none";
  }
});

async function addSong(){
  await addDoc(collection(db,"songs"),{
    uid: auth.currentUser.uid,
    title: newTitle.value,
    lyrics: newLyrics.value
  });
  newTitle.value="";
  newLyrics.value="";
  loadSongs();
}

async function loadSongs(){
  songs.innerHTML="";
  const q=query(collection(db,"songs"),
                where("uid","==",auth.currentUser.uid));
  const snapshot=await getDocs(q);

  snapshot.forEach(doc=>{
    const div=document.createElement("div");
    div.className="song";
    div.innerText=doc.data().title+"\n"+doc.data().lyrics;
    songs.appendChild(div);
  });
}
</script>

</body>
</html>
